{"type":"code","name":"Conformal Prediction - Regression.step","displayName":"Conformal Prediction - Regression.step","description":"","templates":{"SAS":"\n/* BEGIN CONFORMAL PREDICTION */\n\n/* get row count of validation dataset */\nproc sql;select count(*) into :val_cnt from &calibration_data;quit;\n\n/* score validation dataset */\nproc astore;\n\tscore data=&calibration_data out=casuser.score_val rstore=&model_table;\nrun;\n\n/* calculate residuals */\ndata resid;\nset casuser.score_val;\nresidual = abs(&target - P_&target);\nrun;\n\n/* sort residuals */\nproc sort data=resid;by  residual;run;\n\ndata resid_smallest;\nset resid;\nrowid + 1;\nkeep rowid residual;\nrun;\n\nproc sort data=resid;by descending residual;run;\n\ndata resid_biggest;\nset resid;\nrowid + 1;\nkeep rowid residual;\nrun;\n\n/* calculate q */\n\n/* %let alpha=0.1; */\n\ndata _null_;\nq = round((1-&alpha.)*(&val_cnt. + 1));\ncall symput('q',q);\nrun;\n\n/* %put &q.; */\n\n/* find qth residuals */\n\nproc sql;select residual into :c_lower from resid_smallest  where rowid=&q.;quit;\n\nproc sql;\nselect residual into :c_upper from resid_biggest  where rowid=&q.;quit;\n\n/* score model for test data */\nproc astore;\n\tscore data=&test_data out=casuser.score_test rstore=&model_table;\nrun;\n\n\n/* calculate upper and lower bounds for test dataset */\n\ndata &results;\nset casuser.score_test;\nP_Upper = P_&target + &c_lower.;\nP_Lower = P_&target  - &c_lower.;/*changed from lower*/\nrun;\n\n/* END CONFORMAL PREDICTION */\n"},"properties":{},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Parameters\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"model_table\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Model Astore\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"calibration_data\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Calibration Data\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"test_data\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Test Data\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"target\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Target Variable\",\n\t\t\t\t\t\"include\": null,\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"n\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"readonly\": false,\n\t\t\t\t\t\"table\": \"calibration_data\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"alpha\",\n\t\t\t\t\t\"type\": \"numstepper\",\n\t\t\t\t\t\"label\": \"Alpha\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"integer\": false,\n\t\t\t\t\t\"min\": 0.05,\n\t\t\t\t\t\"max\": 0.9,\n\t\t\t\t\t\"stepsize\": 0.05\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"results\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Conformal Results\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"model_table\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"calibration_data\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"test_data\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"target\": [],\n\t\t\"alpha\": 0.1,\n\t\t\"results\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t}\n}","flowMetadata":{"inputPorts":[{"name":"model_table","displayName":"model_table","description":"","minEntries":1,"maxEntries":1,"type":"table"},{"name":"calibration_data","displayName":"calibration_data","description":"","minEntries":1,"maxEntries":1,"type":"table"},{"name":"test_data","displayName":"test_data","description":"","minEntries":1,"maxEntries":1,"type":"table"}],"outputPorts":[{"name":"results","displayName":"results","description":"","minEntries":1,"maxEntries":1,"columnDelta":null,"type":"table"}]}}